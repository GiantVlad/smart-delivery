import{r as n,G,o as H,h as m,C as L,a as x,w as o,_ as M,b as u,d as l,e as Q,g as q,i as w,H as J,v as K,f as C,x as _,E as U,I as T,n as R,p as W,t as y,z as i,k as r,O as X,s as e,F as Y,y as Z,P as V,Q as O,j as P}from"./main-qkurcB6_.js";import{O as ee}from"./Statuses-BSKbIDnF.js";import{s as te}from"./vue-multiselect.esm-BZXF-xii.js";const se={key:1,class:"table-auto w-full",style:{"table-layout":"fixed"}},ae={class:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60"},le={class:"p-2"},oe={class:"items-left font-medium break-words text-gray-800 dark:text-gray-100"},ne={class:"p-2"},ie={class:"break-words"},de={class:"p-2"},ue={class:"break-words font-medium text-green-500"},ce={class:"p-2 whitespace-nowrap"},re={class:"text-left font-medium text-green-500"},pe={class:"p-2"},me={class:"break-words"},ve={class:"p-2"},fe={class:"break-words"},_e={class:"p-2"},be={class:"font-medium text-green-500"},he={key:0},xe={__name:"UpdateOrderInTaskView",setup(ke){const c=n(null),$=n([]),v=n([]),p=n({}),b=n(""),A=G({status:null,orderUuid:null}),d=n({}),B=s=>{d.value[s.uuid]=!d.value[s.uuid],d.value[s.uuid]?A.orderUuid=null:p.value[s.uuid]=s.status};H(()=>{m.get("/api/tasks").then(s=>{$.value=s.data.data.map(t=>({id:t.uuid,label:t.uuid+": "+t.courierName}))})}),L(c,async(s,t)=>{s!==null&&s!==t&&await S()});const S=()=>{m.get("/api/orders-by-task/"+c.value).then(s=>{for(const t of s.data.data)d.value[t.uuid]=!0,p.value[t.uuid]=t.status;v.value=s.data.data})},N=s=>{m.post("/api/unassign-order",{orderUuid:s.uuid}).then(t=>{v.value=v.value.filter(a=>a.uuid!==s.uuid)}).catch(t=>{b.value=t.response.data.message})},D=s=>{m.post("/api/update-order-status-in-task",{status:p.value[s],orderUuid:s}).then(t=>{d.value[A.orderUuid]=!0,v.value.map(a=>{a.uuid===s&&(a.status=p.value[s])}),d.value[s]=!0})},h=n(!1),k=n([]),g=n([]),j=()=>{m.get("/api/orders-to-assign").then(s=>{k.value=s.data.data.map(t=>({id:t.id,label:t.uuid})),h.value=!0})},E=()=>{k.value=[],g.value=[],h.value=!1},F=()=>b.value="",I=()=>{m.post("/api/add-orders-to-task",{taskUuid:c.value,orderUuids:g.value.map(s=>s.label)}).then(s=>{k.value=s.data.data.orders.map(t=>({id:t.id,label:t.uuid})),h.value=!0,S()})};return(s,t)=>(u(),x(M,null,{default:o(()=>[l(Q,null,{default:o(()=>[l(q,{icon:w(J),title:"Update orders in task",main:""},null,8,["icon"]),l(K,{form:"","is-form":!0},{footer:o(()=>[h.value?(u(),_("div",he,[l(U,{label:"Orders"},{default:o(()=>[l(w(te),{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),options:k.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Pick some orders",label:"label","track-by":"label","preselect-first":!1},{selection:o(({values:a,search:f,isOpen:z})=>[a.length?V((u(),_("span",{key:0,class:"multiselect__single"},i(a.length)+" selected ",513)),[[O,!z]]):C("",!0)]),_:1},8,["modelValue","options"])]),_:1}),l(P,null,{default:o(()=>[l(r,{type:"button",color:"info",label:"Add",small:"",onClick:I}),l(r,{type:"button",color:"danger",label:"Cancel",small:"",onClick:E})]),_:1})])):(u(),x(P,{key:1},{default:o(()=>[l(r,{type:"button",color:"info",label:"Add orders",onClick:j})]),_:1}))]),default:o(()=>[l(U,{label:"Task"},{default:o(()=>[l(T,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),options:$.value},null,8,["modelValue","options"])]),_:1}),l(R),b.value&&c.value?(u(),x(W,{key:0,color:"danger"},{right:o(()=>[l(r,{icon:w(X),small:"","rounded-full":"",color:"white",onClick:F},null,8,["icon"])]),default:o(()=>[y(" "+i(b.value),1)]),_:1})):C("",!0),c.value!==null?(u(),_("table",se,[t[4]||(t[4]=e("thead",{class:"text-xs font-semibold uppercase dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50"},[e("tr",null,[e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Order")]),e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Type")]),e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-center"},"Status")]),e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-center"},"Status Action")]),e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-left"},"Pick up")]),e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-center"},"Destination")]),e("th",{class:"p-2 whitespace-nowrap"},[e("div",{class:"font-semibold text-center"},"Assign Action")])])],-1)),e("tbody",ae,[(u(!0),_(Y,null,Z(v.value,a=>(u(),_("tr",{key:a.id},[e("td",le,[e("div",oe,[y(" #"+i(a.id)+" ",1),t[2]||(t[2]=e("br",null,null,-1)),y(" "+i(a.startPointAddress)+" ",1),t[3]||(t[3]=e("br",null,null,-1)),y(" "+i(a.endPointAddress),1)])]),e("td",ne,[e("div",ie,i(a.unitType),1)]),e("td",de,[e("div",ue,i(a.status),1)]),e("td",ce,[e("div",re,[V(l(r,{type:"button",color:"success",label:"Change status",small:"",onClick:f=>B(a)},null,8,["onClick"]),[[O,d.value[a.uuid]]]),V(e("div",null,[l(T,{modelValue:p.value[a.uuid],"onUpdate:modelValue":f=>p.value[a.uuid]=f,options:Object.values(w(ee))},null,8,["modelValue","onUpdate:modelValue","options"]),l(r,{class:"pt-1",type:"button",color:"info",label:"Submit",small:"",onClick:f=>D(a.uuid)},null,8,["onClick"])],512),[[O,!d.value[a.uuid]]])])]),e("td",pe,[e("div",me,i(a.startPointAddress),1)]),e("td",ve,[e("div",fe,i(a.endPointAddress),1)]),e("td",_e,[e("div",be,[l(r,{type:"button",color:"success",label:"Unassign order",small:"",onClick:f=>N(a),class:"whitespace-nowrap"},null,8,["onClick"])])])]))),128))])])):C("",!0)]),_:1})]),_:1})]),_:1}))}};export{xe as default};

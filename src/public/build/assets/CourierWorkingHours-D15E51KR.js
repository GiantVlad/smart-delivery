import{a3 as ee,G as V,r as f,c as te,o as oe,h as b,a as N,w as p,_ as ae,b as r,d as n,e as se,f as U,g as R,i as j,m as re,k as g,v as S,s as t,P as y,x as d,F as T,y as W,z as x,a4 as z,a5 as w,L as P,N as le}from"./main-sBzAe846.js";const de={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end"},ne=["value"],ie=["min"],ue={class:"flex space-x-2"},ce={class:"max-h-96 overflow-y-auto"},fe={class:"table-auto w-full"},me={class:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60"},pe={class:"p-2 whitespace-nowrap"},ye={class:"text-left"},ve={class:"p-2 whitespace-nowrap"},be={class:"text-left"},ge=["onUpdate:modelValue"],xe={class:"p-2 whitespace-nowrap"},ke={class:"text-left"},he=["onUpdate:modelValue"],_e={class:"text-left font-small"},we=["onClick","disabled"],Ce={key:0},De={key:1},$e={key:0,class:"flex justify-center py-8"},He={key:1,class:"overflow-x-auto max-h-96"},Ve={class:"min-w-full bg-white dark:bg-gray-800"},Ue={class:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60"},Fe={class:"p-3 whitespace-nowrap"},Ae={class:"text-left"},Ee={class:"p-3 whitespace-nowrap"},Se={class:"text-left"},Te={class:"p-3 whitespace-nowrap text-right"},We=["onClick","disabled"],Ie={key:0},Ne={key:1},qe={key:0,class:"border-t dark:border-gray-700"},Be={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 mx-4"},Le={class:"space-y-4"},Me={key:0,class:"text-red-500 text-xs mt-1"},Re=["min"],je={key:0,class:"text-red-500 text-xs mt-1"},ze=["value"],Pe={class:"flex justify-end space-x-3 mt-6"},Ke={__name:"CourierWorkingHours",setup(Oe){const k=ee().params.courierId,i=V([]),C=f({}),D=V({}),$=f(!1),m=f(!1),I=f(!1),H=f(!1),A=f(null),E=f(!1),v=f([]),u=V({courier_id:k,date_from:"",date_to:"",reason_code:0}),q=[{value:0,label:"Vacation"},{value:1,label:"Sick Leave"},{value:2,label:"Day Off"},{value:3,label:"Public Holiday"}],h=f({}),l=V({day:"monday",from:"09:00",to:"18:00"}),B=te(()=>{const a=i.map(e=>e.day.toLowerCase());return["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].filter(e=>!a.includes(e))}),L=a=>{const e=C.value[a.id];return e?a.from!==e.from||a.to!==e.to:!1},c=V({id:null,courier_id:k,day:null,from:null,to:null}),O=async a=>{c.id=a.id,c.from=a.from,c.to=a.to,D[a.id]=!0;try{const o=(await b.post(`/api/working-hours/${c.id}`,c)).data.data,s=i.findIndex(M=>M.id===o.id);s!==-1&&(i[s].from=_(o.from),i[s].to=_(o.to),C.value[a.id]={from:i[s].from,to:i[s].to})}catch(e){console.error("Error saving working hours:",e),e.response?.data?.message}finally{c.id=null,c.day=null,c.from=null,c.to=null,D[a.id]=!1}},G=async a=>{if(confirm("Are you sure you want to delete this?")){m[a]=!0;try{await b.post(`/api/working-hours-delete/${a}`);const e=i.findIndex(o=>o.id===a);e!==-1&&(i.splice(e,1),delete C.value[a])}catch(e){F,console.error("Error deleting working hours:",e),e.response?.data?.message}finally{m[a]=!1}}},J=async()=>{if(!l.day||!l.from||!l.to){console.error("Please fill in all fields");return}if(l.from>=l.to){console.error("End time must be after start time");return}m.value=!0;try{const e=(await b.post("/api/working-hours",{courier_id:k,...l})).data.data;e.from=_(e.from),e.to=_(e.to),i.push(e),C.value[e.id]={from:e.from,to:e.to},l.day=B.value[0]||"monday",l.from="09:00",l.to="18:00",$.value=!1}catch(a){console.error("Error creating working hours:",a);const e=a.response?.data?.message||"Failed to create working hours";console.error(e)}finally{m.value=!1}},_=a=>{if(!a)return"";if(/^\d{2}:\d{2}$/.test(a))return a;const[e,o]=a.split(":");return`${e.padStart(2,"0")}:${o.padStart(2,"0")}`},K=async()=>{I.value=!0;try{const a=await b.get(`/api/courier-holidays/${k}`);v.value=a.data.data}catch(a){console.error("Error fetching holidays:",a)}finally{I.value=!1}},Q=async()=>{H.value=!0,h.value={};try{const a=await b.post("/api/courier-holidays",u);v.value=a.data.data,E.value=!1,u.date_from="",u.date_to="",u.reason_code=0}catch(a){a.response?.status===422?h.value=a.response.data.errors||{}:console.error("Error adding holiday:",a)}finally{H.value=!1}},X=async a=>{if(confirm("Are you sure you want to delete this holiday?")){A.value=a;try{const e=v.value.find(s=>s.id===a);if(!e)return;const o=s=>s?new Date(s).toISOString().split("T")[0]:"";await b.post("/api/courier-holidays-delete",{courier_id:k,date_from:o(e.date),date_to:o(e.date)}),v.value=v.value.filter(s=>s.id!==a)}catch(e){console.error("Error deleting holiday:",e)}finally{A.value=null}}},Y=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",Z=a=>{const e=q.find(o=>o.value===a);return e?e.label:"Unknown"};return oe(()=>{b.get(`/api/working-hours/${k}`).then(a=>{const e=a.data.data.map(o=>({...o,from:_(o.from),to:_(o.to)}));i.push(...e),C.value=e.reduce((o,s)=>(o[s.id]={from:s.from,to:s.to},o),{})}).catch(a=>{console.error("Error fetching working hours:",a)}),K()}),(a,e)=>(r(),N(ae,null,{default:p(()=>[n(se,null,{default:p(()=>[n(R,{icon:j(re),title:"Courier's working hours",main:""},{default:p(()=>[n(g,{color:"info",label:"Add Working Hours",onClick:e[0]||(e[0]=o=>$.value=!$.value)})]),_:1},8,["icon"]),$.value?(r(),N(S,{key:0,class:"mb-6 p-6"},{default:p(()=>[e[13]||(e[13]=t("h3",{class:"text-lg font-medium mb-4"},"Add New Working Hours",-1)),t("div",de,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Day",-1)),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.day=o),class:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600"},[(r(!0),d(T,null,W(B.value,o=>(r(),d("option",{key:o,value:o},x(o.charAt(0).toUpperCase()+o.slice(1)),9,ne))),128))],512),[[z,l.day]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"From",-1)),y(t("input",{type:"time","onUpdate:modelValue":e[2]||(e[2]=o=>l.from=o),class:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600",required:""},null,512),[[w,l.from]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"To",-1)),y(t("input",{type:"time","onUpdate:modelValue":e[3]||(e[3]=o=>l.to=o),class:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600",min:l.from,required:""},null,8,ie),[[w,l.to]])]),t("div",ue,[n(g,{color:"success",label:"Save",disabled:m.value,class:P({"opacity-50 cursor-not-allowed":m.value}),onClick:J},null,8,["disabled","class"]),n(g,{color:"danger",outline:"",label:"Cancel",onClick:e[4]||(e[4]=o=>$.value=!1)})])])]),_:1})):U("",!0),n(S,{class:"mb-6","has-table":""},{default:p(()=>[t("div",ce,[t("table",fe,[e[15]||(e[15]=t("thead",{class:"text-xs font-semibold uppercase dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50"},[t("tr",null,[t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-left"},"Day of the week")]),t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-left"},"From")]),t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-left"},"To")]),t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-left"},"Action")])])],-1)),t("tbody",me,[(r(!0),d(T,null,W(i,o=>(r(),d("tr",{key:o.id},[t("td",pe,[t("div",ye,x(o.day),1)]),t("td",ve,[t("div",be,[y(t("input",{type:"time","onUpdate:modelValue":s=>o.from=s,class:"w-24 p-1 border rounded dark:bg-gray-700 dark:border-gray-600"},null,8,ge),[[w,o.from]])])]),t("td",xe,[t("div",ke,[y(t("input",{type:"time","onUpdate:modelValue":s=>o.to=s,class:"w-24 p-1 border rounded dark:bg-gray-700 dark:border-gray-600"},null,8,he),[[w,o.to]])])]),t("div",_e,[n(g,{type:"button",color:"success",label:D[o.id]?"Saving...":"Save",small:"",disabled:!L(o)||D[o.id],class:P({"opacity-50 cursor-not-allowed":!L(o)||D[o.id]}),onClick:s=>O(o)},null,8,["label","disabled","class","onClick"]),e[14]||(e[14]=t("span",{class:"mx-2"},null,-1)),t("button",{onClick:s=>G(o.id),class:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",disabled:m.value},[m.value?(r(),d("span",Ce,"Deleting...")):(r(),d("span",De,"Delete"))],8,we)])]))),128))])])])]),_:1}),n(R,{icon:j(le),title:"Holidays",class:"mt-12"},{default:p(()=>[n(g,{color:"info",label:"Add Holiday",onClick:e[5]||(e[5]=o=>E.value=!0)})]),_:1},8,["icon"]),n(S,{class:"mb-6","has-table":""},{default:p(()=>[I.value?(r(),d("div",$e,[...e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"},null,-1)])])):(r(),d("div",He,[t("table",Ve,[e[18]||(e[18]=t("colgroup",null,[t("col",{class:"w-1/3"}),t("col",{class:"w-1/3"}),t("col",{class:"w-1/3"})],-1)),e[19]||(e[19]=t("thead",{class:"text-xs font-semibold uppercase dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50"},[t("tr",null,[t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-left"},"Date")]),t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-left"},"Reason")]),t("th",{class:"p-2 whitespace-nowrap"},[t("div",{class:"font-semibold text-right"},"Actions")])])],-1)),t("tbody",Ue,[(r(!0),d(T,null,W(v.value,o=>(r(),d("tr",{key:o.id,class:"border-t dark:border-gray-700"},[t("td",Fe,[t("div",Ae,x(Y(o.date)),1)]),t("td",Ee,[t("div",Se,x(Z(o.reason_code)),1)]),t("td",Te,[t("button",{onClick:s=>X(o.id),class:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",disabled:A.value===o.id},[A.value===o.id?(r(),d("span",Ie,"Deleting...")):(r(),d("span",Ne,"Delete"))],8,We)])]))),128)),v.value.length===0?(r(),d("tr",qe,[...e[17]||(e[17]=[t("td",{colspan:"3",class:"p-4 text-center text-gray-500 dark:text-gray-400"}," No holidays found ",-1)])])):U("",!0)])])]))]),_:1}),E.value?(r(),N(S,{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},{default:p(()=>[t("div",Be,[e[23]||(e[23]=t("h2",{class:"text-xl font-semibold mb-4 dark:text-white"},"Add Holiday",-1)),t("div",Le,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"From Date",-1)),y(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=o=>u.date_from=o),class:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},null,512),[[w,u.date_from]]),h.value.date_from?(r(),d("p",Me,x(h.value.date_from[0]),1)):U("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"To Date",-1)),y(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>u.date_to=o),class:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:u.date_from,required:""},null,8,Re),[[w,u.date_to]]),h.value.date_to?(r(),d("p",je,x(h.value.date_to[0]),1)):U("",!0)]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Reason",-1)),y(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>u.reason_code=o),class:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},[(r(),d(T,null,W(q,o=>t("option",{key:o.value,value:o.value},x(o.label),9,ze)),64))],512),[[z,u.reason_code]])])]),t("div",Pe,[n(g,{color:"danger",outline:"",label:"Cancel",onClick:e[9]||(e[9]=o=>E.value=!1),disabled:H.value},null,8,["disabled"]),n(g,{color:"success",label:H.value?"Saving...":"Save",onClick:Q,disabled:H.value},null,8,["label","disabled"])])])]),_:1})):U("",!0)]),_:1})]),_:1}))}};export{Ke as default};
